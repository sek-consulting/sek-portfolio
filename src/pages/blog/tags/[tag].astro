---
import { getCollection } from "astro:content";
import Blog from "../../../layouts/Blog.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts
    .map((post) => post.data.tags) // 3d array of tags
    .flat() // flatten to 2d array
    .filter((tag, i, arr) => arr.indexOf(tag) === i) // filter out duplicates
    .map((tag) => ({ params: { tag: tag } }));
}

const { tag } = Astro.params;

const posts = (await getCollection("blog")).filter((post) =>
  post.data.tags.includes(tag ?? "")
);
---

<Blog posts={posts} heading={`#${tag}`} />
